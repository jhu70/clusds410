---
title: "Shiny"
author: "Paige Patrick"
date: "4/2/2019"
output: html_document
---

```{r Packages}
library(shiny)
library(shinydashboard)
library(leaflet) 

## FILES YOU NEED TO RUN BEFORE HAND:
## providers_in_polygons.Rmd
## Capacity Map FINAL.Rmd
## Hours_Supply_Maps_by_tract.Rmd
## Hours Demand Maps FINAL.Rmd
```

```{r Empty Dashboards}

header <- dashboardHeader()
sidebar <- dashboardSidebar()
body <- dashboardBody()

ui <- dashboardPage(header, sidebar, body)

server <- function(input, output)  {}

#shinyApp(ui, server)

```

```{r Header}

## HEADER

header_test <- dashboardHeader(
  dropdownMenu(type = "messages",
               messageItem(
                 from = "Community Labor United",
                 message = "Contact us for more information",
                 href = "http://massclu.org/about/"
                 )),
  dropdownMenu(type = "notifications",
               notificationItem(
                 text = "CLU: Care That Works",
                 href = "http://massclu.org/initiatives/#childcare"
                 ))
)

```

```{r Sidebar and Body}

## SIDEBAR

sidebar1 <- dashboardSidebar(
  sidebarMenu(
    
    ## INRODUCTION
    
    menuItem("Introduction",
             tabName = "introduction"),
    
    ## CAPACITY
    
    menuItem("Capacity",
             tabName = "capacity"
             ),
    
    ## HOURS
    
    menuItem("Hours",
             tabName = "hours"
             ),
    
    ##MEHODOLOGY
    
    menuItem("Methodology",
             tabName = "methodology")
  )
)

## BODY

body1 <- dashboardBody(
  tabItems(
    
    ## INTRODUCTION
    
    tabItem(tabName = "introduction",
            tags$br(),
            tags$b("Hey there friend! "),
            ## Any text immediately following will NOT be on a seperate line
            ## tags$b/em() = text is bold/italicized 
            tags$em("Here's a brief overview of hours, capacity, and subsidy"),
            ## tags$br() = line break
            tags$br()
            ),
    
    ## CAPACITY
    
    tabItem(tabName = "capacity",
            tags$h1("Number of children under 6 with all parents in the labor
                    force, per tract"),
            tags$br(),
            leafletOutput("laborforce_demand"),
            tags$br(),
            tags$h1("Number of slots for Early Education Providers, per tract"),
            leafletOutput("slots_supply"),
            tags$h1("Ratio of Number of Children to Avaliable Number of Slots, per neighborhood"),
            leafletOutput("ratioslots_gap"),
            tags$br(),
            tags$br(),
            plotOutput("all_neighborhoods_bar"),
            tags$br(),
            tags$br(),
            plotOutput("top_5_neighborhoods_bar")
            ),
    
    ## HOURS

    tabItem(tabName = "hours",
            tags$h1("Percent of People Who Work Early, Evening, and Overnight Hours (per tract)"),
            tags$br(),
            tags$br(),
            fluidRow(
              box(
                width = 4,
                title = "Early Hours",
                em("leaving home between 12:00am - 6:59am"),
                br(),
                leafletOutput("percent_early"),
                status = "danger"
                ),
              box(
                width = 4,
                title = "Evening Hours",
                em("leaving home between 11:00am - 3:59pm"),
                br(),
                leafletOutput("percent_evening"),
                status = "danger"
                ),
              box(
                width = 4,
                title = "Overnight Hours",
                em("leaving home between 4:00pm - 11:59pm"),
                br(),
                leafletOutput("percent_overnight"),
                status = "danger"
              )
            ),
            tags$h1("General Irregular Hours Demand"),
            fluidRow(
              box(
                width = 8,
                leafletOutput("weekdays_offhours"),
                status = "danger"),
              box(
                width = 4,
                title = "_______",
                em("blah blah blah"),
                status = "danger"
              )
              )
    ),
    
    ## METHODOLOGY
    
    tabItem(tabName = "methodology",
            fluidRow(
              column(width = 12,
                     box(
                       title = "Capacity",
                       width = NULL,
                       solidHeader = TRUE, 
                       collapsible = TRUE,
                       collapsed = FALSE,
                       status = "info",
                       tags$h4("Percent of Children Under 6 with all parents in
                               the labor force"),
                       em("This demand variable was created using information provided by 
                         the 2016 American Community Survice data, which we accessed through tidycensus in R."),
                       br(),
                       br(),
                       p("Wtihin the ACS data, there were three distinct variables that recorded number of parents
                         in the labor force with children under 6 for each census tract in the Boston area. 
                         One of the variables (B23008_004) gave us the parents in the labor force that came from a 
                         2-parent household, while the other two variables (B23008_010, B23008_013) gave us the parents
                         in the labor force that came from a 1-parent household. Using this information, we were to get
                         the total sum of all children with all parents in the labor force. Using the ACS data, we then 
                         extracted the total number of children under 6 per tract (B23008_002).",
                         style = "font-family: 'times'; font-si16pt"),
                       strong("We were able to find the percent of children under 6 with all parents in the labor 
                              force per tract, by taking the sum of children with all parents in the labor force over 
                              the estimated _______.",
                         style = "font-family: 'times'; font-si16pt"),
                       br(),
                       tags$h4("Capacity for Early Education Providers"),
                       em("This supply variable was created using the EEC dataset given to us by Community Labor United."),
                       br(),
                       br()
                     ),
                     box(
                       title = "Hours",
                       width = NULL,
                       solidHeader = TRUE,
                       collapsible = TRUE,
                       collapsed = TRUE,
                       status = "info",
                       p("p creates a paragraph of text."),
                       p("A new p() command starts a new paragraph. Supply a style
                        attribute to change the format of the entire paragraph.",
                        style = "font-family: 'times'; font-si16pt"),
                       strong("strong() makes bold text."),
                       em("em() creates italicized (i.e, emphasized) text."),
                       br(),
                       code("code displays your text similar to computer code"),
                       div("div creates segments of text with a similar style. This
                           division of text is all blue because I passed the argument
                           'style = color:blue' to div", style = "color:blue"),
                       br(),
                       p("span does the same thing as div, but it works with",
                         span("groups of words", 
                              style = "color:blue"),
                         "that appear inside a paragraph.")
                     )
                     )
            ))
  )
)

```


```{r UI and Server}

## UI 

ui <- dashboardPage(dashboardHeader(title = "CLU", dropdownMenu()),
                    skin = "purple",
                    header = header_test,
                    sidebar = sidebar1,
                    body = body1
                    )
## SERVER

server <- function(input, output) {
  ## CAPACITY
  output$laborforce_demand <- renderLeaflet({
    leaflet(neighborho_demand_tract) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_laborforce(laborforce),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood, 
                  weight = 2, 
                  opacity = 1, 
                  fillOpacity = 0, 
                  stroke = TRUE, 
                  color = "black", 
                  label = ~Name) %>% 
      #adding neighborhood data
      setView(lng = -71.057083, 
              lat = 42.361145, 
              zoom = 11.5) %>%
      addLegend("topleft", 
                pal = pal_laborforce, 
                values = ~laborforce,
                opacity = 1)
  })
  
  output$slots_supply <- renderLeaflet({
    leaflet(neighborho_capacity_tract) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_slots(slots),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood, 
                  weight = 2, 
                  opacity = 1, 
                  fillOpacity = 0, 
                  stroke = TRUE, 
                  color = "black", 
                  label = ~Name) %>% 
      #adding neighborhood data
      setView(lng = -71.057083, 
              lat = 42.361145, 
              zoom = 11.5) %>%
      addLegend("topleft", 
                pal = pal_slots, 
                values = ~slots,
                opacity = 1)
  })
  
  output$ratioslots_gap <- renderLeaflet({
    leaflet(EEC_census) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_ratioslots(ratioslots),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood,
                  weight = 2,
                  opacity = 1,
                  fillOpacity = 0,
                  stroke = TRUE,
                  color = "black",
                  label = ~Name) %>%
      #adding neighborhood data
      setView(lng = -71.057083,
              lat = 42.361145,
              zoom = 11.5) %>%
      addLegend("topleft",
                pal = pal_ratioslots,
                values = ~ratioslots,
                opacity = 1)
  })
  
  output$all_neighborhoods_bar <- renderPlot({
    ggplot(EEC_census_bar, 
           aes(x = reorder(Name_neighborho,-ratioslots), y = ratioslots, fill =Name_neighborho)) + 
      geom_bar(colour = "black", 
           stat = "identity") + 
      ggtitle( "Neighborhood ranking by desert ratio") + 
      xlab("Neighborhoods") + 
      ylab("Desert Ratio (Population under 6/Capacity for early ed")
  })
  
  output$top_5_neighborhoods_bar <- renderPlot({
    ggplot(EEC_census_bar5,
           aes(x = reorder(Name_neighborho,-ratioslots), y = ratioslots, fill = Name_neighborho)) +
      geom_bar(colour = "black", stat = "identity") + 
      ggtitle( "Top 5 Neighborhood ranking with the highest desert ratio") + 
      xlab("Neighborhoods") + 
      ylab("Desert Ratio (Population under 6/Capacity for early ed")
  })
  ## HOURS
  output$percent_early <- renderLeaflet({
    leaflet(hours_demand) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_early(percent_early),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood,
                  weight = 2,
                  opacity = 1,
                  fillOpacity = 0,
                  stroke = TRUE,
                  color = "black",
                  label = ~Name) %>%
      #adding neighborhood data
      setView(lng = -71.057083,
              lat = 42.361145,
              zoom = 11.5) %>%
      addLegend("topleft",
                pal = pal_early,
                values = ~percent_early,
                opacity = 1)
  })
  
  output$percent_evening <- renderLeaflet({
    leaflet(hours_demand) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_evening(percent_evening),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood,
                  weight = 2,
                  opacity = 1,
                  fillOpacity = 0,
                  stroke = TRUE,
                  color = "black",
                  label = ~Name) %>%
      #adding neighborhood data
      setView(lng = -71.057083,
              lat = 42.361145,
              zoom = 11.5) %>%
      addLegend("topleft",
                pal = pal_evening,
                values = ~percent_evening,
                opacity = 1)
  })
  
  output$percent_overnight <- renderLeaflet({
    leaflet(hours_demand) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_overnight(percent_overnight),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood,
                  weight = 2,
                  opacity = 1,
                  fillOpacity = 0,
                  stroke = TRUE,
                  color = "black",
                  label = ~Name) %>%
      #adding neighborhood data
      setView(lng = -71.057083,
              lat = 42.361145,
              zoom = 11.5) %>%
      addLegend("topleft",
                pal = pal_overnight,
                values = ~percent_overnight,
                opacity = 1)
  })
  
  output$weekdays_offhours <- renderLeaflet({
    leaflet(EEC_geometry) %>%
      addProviderTiles("CartoDB")  %>%
      addPolygons(fillColor = ~pal_weekdays(sumcapacity_weekdaysoff),
                  weight = 2,
                  opacity = .8,
                  color = "white",
                  dashArray = "3",
                  fillOpacity = 0.7) %>%
      addPolygons(data = boston_neighborhood, 
                  weight = 2, 
                  opacity = 1, 
                  fillOpacity = 0, 
                  stroke = TRUE, 
                  color = "black", 
                  label = ~Name) %>% 
      #adding neighborhood data
      setView(lng = -71.057083, 
              lat = 42.361145, 
              zoom = 11) %>%
      addLegend("topleft", 
                pal = pal_weekdays, 
                values = ~sumcapacity_weekdaysoff,
                title = "Weekdays_offhours",
                opacity = 1)
  })
}

# server <- function(input, output, session) {
#   reactive_data <- reactiveFileReader(
#     intervalMillis = 1000,
#     session = session,
#     filePath = "file.csv",
#     #readFunc = read.csv
#     readFunc = function
#     (filePath) {
#       read.csv(url(filePath))
#     }
#   )
# }
#   output$printed_data <- renderPrint({
#     reactive_data()
#   })
# }

## SHINYAPP

shinyApp(ui, server)

```


