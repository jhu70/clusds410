---
title: "Demand Data"
author: "Kat Kyuchukova"
date: "3/23/2019"
output: html_document
---

```{r Packages}
library(tidycensus)
library(tidyverse)
<<<<<<< HEAD
library(ggplot2)
=======
library(tigris)
library(sf)
library(mosaic)
library(mapview)
library(leaflet)
library(leaflet.extras)
>>>>>>> 22b528ae22355cc306c9de6d2c56fb271ea33545
```

```{r API Key}
## define census API key and set it with census_api_key function

api_key <- "8fa9f8cc6afff6f16cfa41d92974f406a35636a6"
census_api_key(api_key)

## check API key

Sys.getenv("CENSUS_API_KEY")
```

<<<<<<< HEAD
```{r Search Variables}

# Load variable for 2016 from the acs dataset (acs data is from 2013-2017)

acs_2016 <- load_variables(2016, "acs5", cache = TRUE)

# Searching for any variables in the dataset created above related to race

acs_2016_race <- acs_2016 %>%
  filter(str_detect(label,
                    fixed("race", 
                          ignore_case = TRUE)))

# Searching for any variables in the dataset created above related to income

acs_2016_income <- acs_2016 %>%
  filter(str_detect(label, 
                    fixed("income", 
                          ignore_case = TRUE)))

# Searching for any variables in the dataset created above related to number of children

acs_2016_children <- v15 %>%
  filter(str_detect(label, 
                    fixed("number of children", 
                          ignore_case = TRUE)))
=======
```{r}
v15 <- load_variables(2016, "acs5", cache = TRUE)

v15_race <- v15 %>%
  filter(str_detect(label, fixed("race", 
                                ignore_case = TRUE)))
v15_income <- v15 %>%
  filter(str_detect(label, fixed("income", 
                                ignore_case = TRUE)))
>>>>>>> 22b528ae22355cc306c9de6d2c56fb271ea33545

# Searching for any variables in the dataset created above related to commute

acs_2016_commute <- v15 %>%
  filter(str_detect(label, 
                    fixed("transportation", 
                          ignore_case = TRUE)))

#acs_2016_race
#acs_2016_income
#acs_2016_children
acs_2016_commute

```

Variable names:
B19013_001: median household income
B23020_001: MEAN USUAL HOURS WORKED IN THE PAST 12 MONTHS FOR WORKERS 16 TO 64 YEARS

B08302_001:B08302_015 -- Time leaving home to go to work
B08602_001:015 -- Time arriving at work from home
C24070_001:084 -- INDUSTRY BY CLASS OF WORKER FOR THE CIVILIAN EMPLOYED POPULATION 16 YEARS AND OVER
B23008_001:B23008_027 -- AGE OF OWN CHILDREN UNDER 18 YEARS IN FAMILIES AND SUBFAMILIES BY LIVING ARRANGEMENTS BY EMPLOYMENT STATUS OF PARENTS
B09002_001:B09002_020 -- OWN CHILDREN UNDER 18 YEARS BY FAMILY TYPE AND AGE
B08303_001:B08303_013 -- travel time to work
C02003_002:C02003_019-- detailed race, Estimate!!Total!!Population of one race!!White/etc.

##Example: Time Leaving home
```{r}
leavinghome_vars <- c("B08302_001", "B08302_002", "B08302_003", "B08302_004", "B08302_005", "B08302_006", "B08302_007", "B08302_008", "B08302_009", "B08302_010", "B08302_011", "B08302_012", "B08302_013", "B08302_014", "B08302_015")

leavinghome_before7am_vars <- c("B08302_002", "B08302_003", "B08302_004", "B08302_005", "B08302_006")
leavinghome_am_vars <- c("B08302_002", "B08302_003", "B08302_004", "B08302_005", "B08302_006")

leavinghome_before7 <- get_acs(geography = "tract",
                     variables = leavinghome_before7am_vars,
                     survey="acs5",
                     state= "MA",
                     county="Suffolk",
                geometry=TRUE)


 leavinghome_after4 <- get_acs(geography = "tract",
                     variables = "B08302_015",
                     survey="acs5",
                     state= "MA",
                     county="Suffolk",
                geometry=TRUE)

plot(leavinghome_before7["estimate"])

ggplot(leavinghome_before7, aes(fill=estimate)) + geom_sf()
ggplot(leavinghome_after4, aes(fill=estimate)) + geom_sf()

m <- mapview(leavinghome_before7, zcol="estimate")
m@map

m2 <- mapview(leavinghome_after4, zcol="estimate")
m2@map

```



##Median income
```{r}
med_income <- get_acs(geography = "tract",
                     variables = "B19013_001",
                     survey="acs5",
                     state= "MA",
                     county="Suffolk",
                geometry=TRUE)

mapviewGetOption("basemaps")
mapviewOptions(basemaps = c("CartoDB.Positron","OpenStreetMap"),
               raster.palette = grey.colors,
               vector.palette = colorRampPalette(c("snow", "cornflowerblue", "grey10")),
               layers.control.pos = "topright")

income_map <- mapview(med_income, zcol="estimate")
income_map@map

```

Travel time to work

```{r}
B08303_001:B08303_013

travel_time_vars <- c("B08303_001", "B08303_002", "B08303_003", "B08303_004", "B08303_005", "B08303_006", "B08303_007", "B08303_008", "B08303_009", "B08303_010", "B08303_011", "B08303_012", "B08303_013")

travel_time <- get_acs(geography = "tract",
                     variables = travel_time_vars,
                     survey="acs5",
                     state= "MA",
                     county="Suffolk",
                geometry=TRUE)

travel_time_long <- travel_time %>%
  spread(variable, estimate)

travel_time_long[is.na(travel_time_long)] <- 0

travel_time_long <- travel_time_long %>%
  group_by(GEOID, NAME) %>%
  summarise(under_30 = sum(B08303_001 + B08303_002 + B08303_003 + B08303_004 + B08303_005 + B08303_006 + B08303_007),
            thirty_to_sixty = sum(B08303_008 +B08303_009 + B08303_010 + B08303_011),
            sixty_to_ninety = sum(B08303_012),
            over_ninety = sum(B08303_013)) %>%
  gather(key = "travel_mins", value= "number_of_people", -GEOID, -NAME, -geometry) %>%
  arrange(NAME)

mapviewGetOption("basemaps")
mapviewOptions(basemaps = c("CartoDB.Positron","OpenStreetMap"),
               raster.palette = grey.colors,
               vector.palette = colorRampPalette(c("snow", "cornflowerblue", "grey10")),
               layers.control.pos = "topright")

travel_time_map <- mapview(travel_time_long, zcol="number_of_people")
travel_time@map
```





Tracts?
```{r}
<<<<<<< HEAD
test <- get_acs(geography = "tract",
                     variables = "B08303_001", 
                     survey = "acs5", 
                     state= "MA"
                     )

head(test)
```
```{r}
b08303_table <- filter(acs5, 
                 str_detect(name, "B08303"))

b0803_table

## can search for related variables 

b0803_searching_variable <- filter(acs5_2016,
                             str_detect(label,
                                        fixed("commute",
                                              ignore_case = TRUE)))

b0803_searching_variable
=======
ma_tracts <- tracts(state="MA", county="Suffolk")
plot(ma_tracts)
>>>>>>> 22b528ae22355cc306c9de6d2c56fb271ea33545
```

```{r}
race_vars <- c()

ma_race <- get_acs(geography = "county",
               state = "MA",
               variables = race_vars,
               summary_var = "B03002_001")
```




